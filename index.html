<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Transparent Electron App</title>
    <link rel="stylesheet" href="styles.css">
</head>

<body
    style="background: transparent; margin: 0; padding: 0; display: flex; justify-content: center; align-items: flex-start; overflow: hidden;">
    <img id="logo" src="./TrovinnLogo-01.png" alt=""
        style="width: 100%; height: auto; object-fit: contain; pointer-events: auto; cursor: grab; user-select: none; -webkit-user-drag: none; display: block;">
    <script>
        const { ipcRenderer } = require('electron');
        const logo = document.getElementById('logo');
        let isDragging = false;
        let dragOffset = { x: 0, y: 0 };

        // Logo variants
        const logos = [
            './TrovinnLogo-01.png',
            './TrovinnLogo-02.png',
            './TrovinnLogo-03.png',
            './TrovinnLogo-04.png',
        ];
        let currentLogoIndex = 0;

        logo.addEventListener('dblclick', () => {
            currentLogoIndex = (currentLogoIndex + 1) % logos.length;
            logo.src = logos[currentLogoIndex];
        });

        logo.addEventListener('mouseenter', () => {
            ipcRenderer.send('set-ignore-mouse-events', false);
        });

        logo.addEventListener('mouseleave', () => {
            if (!isDragging) {
                ipcRenderer.send('set-ignore-mouse-events', true, { forward: true });
            }
        });

        logo.addEventListener('mousedown', (e) => {
            isDragging = true;
            logo.style.cursor = 'grabbing';

            // Get current window position
            ipcRenderer.send('get-window-position');

            // Store the offset from window top-left to where user clicked
            ipcRenderer.once('window-position', (event, bounds) => {
                dragOffset.x = e.screenX - bounds.x;
                dragOffset.y = e.screenY - bounds.y;
            });
        });

        window.addEventListener('mousemove', (e) => {
            if (isDragging) {
                // Move window maintaining the grab position
                const x = Math.round(e.screenX - dragOffset.x);
                const y = Math.round(e.screenY - dragOffset.y);
                ipcRenderer.send('window-move', { x, y });
            }
        });

        window.addEventListener('mouseup', (e) => {
            if (isDragging) {
                isDragging = false;
                logo.style.cursor = 'grab';
            }
        });

        // Keyboard shortcuts for resizing
        document.addEventListener('keydown', (e) => {
            console.log('Key pressed:', e.key, 'Code:', e.code, 'KeyCode:', e.keyCode);

            // Plus/Equals key (+ or =)
            // e.key for + is '+', for = is '='
            // Also check keyCode: 187 is =/+ key, 107 is numpad +
            if (e.key === '+' || e.key === '=' || e.code === 'Equal' || e.keyCode === 187 || e.keyCode === 107) {
                e.preventDefault();
                console.log('Sending resize +100');
                ipcRenderer.send('resize-window', 100); // Increase by 100
            }
            // Minus/Underscore key (- or _)
            // e.key for - is '-', for _ is '_'
            // Also check keyCode: 189 is -/_ key, 109 is numpad -
            else if (e.key === '-' || e.key === '_' || e.code === 'Minus' || e.keyCode === 189 || e.keyCode === 109) {
                e.preventDefault();
                console.log('Sending resize -100');
                ipcRenderer.send('resize-window', -100); // Decrease by 100
            }
        });
    </script>
</body>

</html>